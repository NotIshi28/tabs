<html>
  <head>
<title>Totally Accurate Battle Simulator</title>
<style>
  body { 
    font-family: Arial, sans-serif;
    background-color: #1a1a2e;
    color: #e0e0e0;
    display: flex;
    flex-direction: column;
    height: 100vh;
    margin: 0;
    padding: 0;
    overflow: hidden;
  }
  #game-container {
    flex-grow: 1;
    background-color: #16213e;
    border: 2px solid #0f3460;
    position: relative;
    overflow: hidden;
    cursor: crosshair;
  }
  #controls-panel {
    background-color: #0f3460;
    padding: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .control-group {
    display: flex;
    align-items: center;
  }
  select, button {
    margin: 0 5px;
    padding: 5px 10px;
    background-color: #1a1a2e;
    color: #e0e0e0;
    border: none;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  button:hover, select:hover { background-color: #e94560; }
  #speed-control {
    display: flex;
    align-items: center;
  }
  #speed-slider {
    width: 100px;
  }
  .unit {
    width: 40px;
    height: 40px;
    position: absolute;
    transition: all 0.2s linear;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }
  .team-indicator {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    position: absolute;
    opacity: 0.5;
  }
  .blue .team-indicator { background-color: #3498db; }
  .red .team-indicator { background-color: #e74c3c; }
  .purple .team-indicator { background-color: #9b59b6; }
  .weapon-icon {
    width: 30px;
    height: 30px;
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    z-index: 1;
  }
  .warrior .weapon-icon { background-image: none; }
  .warrior .wooden-sword {
    position: absolute;
    width: 6px;
    height: 40px;
    background-color: #8B4513;
    border-radius: 1px;
    transition: all 0.2s linear;
    z-index: 2;
  }
  .warrior .wooden-sword::before {
    content: '';
    position: absolute;
    width: 12px;
    height: 4px;
    background-color: #D2691E;
    top: -4px;
    left: -3px;
    border-radius: 1px;
  }
  .warrior .wooden-sword::after {
    content: '';
    position: absolute;
    width: 0;
    height: 0;
    border-left: 3px solid transparent;
    border-right: 3px solid transparent;
    border-bottom: 10px solid #8B4513;
    bottom: -10px;
    left: 0;
  }
  .warrior.attacking .wooden-sword {
    transform: rotate(90deg);
  }
  .mage .wooden-staff {
    position: absolute;
    width: 4px;
    height: 50px;
    background-color: #8B4513;
    border-radius: 1px;
    transition: all 0.2s linear;
    z-index: 2;
  }
  .mage .wooden-staff::before {
    content: '';
    position: absolute;
    width: 10px;
    height: 10px;
    background-color: #9932CC;
    border-radius: 50%;
    top: -8px;
    left: -3px;
    box-shadow: 0 0 5px #9932CC;
  }
  .archer .weapon-icon { background-image: none; }
  .archer .bow {
    position: absolute;
    width: 30px;
    height: 40px;
    border-top: 4px solid #8B4513;
    border-right: 4px solid #8B4513;
    border-bottom: 4px solid #8B4513;
    border-left: none;
    border-radius: 0 100px 100px 0;
    transform: rotate(0deg);
    transition: all 0.2s linear;
    z-index: 2;
  }
  .archer .bow::before {
    content: '';
    position: absolute;
    width: 2px;
    height: 36px;
    background-color: #F4A460;
    left: 0px;
    top: 2px;
  }
  .archer.attacking .bow {
    transform: rotate(-30deg);
  }
  .healer .weapon-icon 
  { 
    background-image: none; 
  }
  .healer .healing-staff {
    position: absolute;
    width: 4px;
    height: 50px;
    background-color: #8B4513;
    border-radius: 1px;
    transition: all 0.2s linear;
    z-index: 2;
  }
  .healer .healing-staff::before {
    content: '';
    position: absolute;
    width: 10px;
    height: 10px;
    background-color: #FF0000;
    border-radius: 50%;
    top: -8px;
    left: -3px;
    box-shadow: 0 0 5px #FF0000;
  }
  .tank .weapon-icon { background-image: none; }
  .tank .iron-shield {
    position: absolute;
    width: 30px;
    height: 40px;
    background-color: #708090;
    border: 2px solid #2F4F4F;
    border-radius: 5px;
    transition: all 0.2s linear;
    z-index: 2;
    left: -15px;
  }
  .tank .iron-sword {
    position: absolute;
    width: 6px;
    height: 30px;
    background-color: #C0C0C0;
    border-radius: 1px;
    transition: all 0.2s linear;
    z-index: 3;
    right: -3px;
  }
  .tank .iron-sword::before {
    content: '';
    position: absolute;
    width: 12px;
    height: 4px;
    background-color: #A9A9A9;
    top: -4px;
    left: -3px;
    border-radius: 1px;
  }
  .tank .iron-sword::after {
    content: '';
    position: absolute;
    width: 0;
    height: 0;
    border-left: 3px solid transparent;
    border-right: 3px solid transparent;
    border-bottom: 8px solid #C0C0C0;
    bottom: -8px;
    left: 0;
  }
  .tank.attacking .iron-sword {
    transform: rotate(45deg);
  }
  .musketman .weapon-icon { background-image: none; }
  .musketman .musket {
    position: absolute;
    width: 50px;
    height: 10px;
    background-color: #8B4513;
    border-radius: 2px;
    transition: all 0.2s linear;
    z-index: 2;
  }
  .musketman .musket::before {
    content: '';
    position: absolute;
    width: 15px;
    height: 25px;
    background-color: #D2691E;
    bottom: -8px;
    right: 0;
    border-radius: 2px;
  }
  .musketman .musket::after {
    content: '';
    position: absolute;
    width: 10px;
    height: 5px;
    background-color: #A0522D;
    top: 10px;
    left: 5px;
    border-radius: 1px;
  }
  .musketman.attacking .musket {
    transform: rotate(-10deg);
  }
  .projectile {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    position: absolute;
    transition: all 0.5s linear;
  }
  .attack-projectile { background-color: #95a5a6; }
  .mage-projectile { 
    background-color: #3498db;
    box-shadow: 0 0 10px #3498db;
  }
  .heal-projectile { background-color: #e74c3c; }
  .musket-projectile {
    width: 5px;
    height: 5px;
    background-color: #2c3e50;
  }
  .health-bar {
    width: 40px;
    height: 5px;
    background-color: #27ae60;
    position: absolute;
    top: -10px;
    left: 0;
    display: none;
  }
  .unit:hover .health-bar, .show-health-bars .health-bar {
    display: block;
  }
  .unit-label {
    position: absolute;
    bottom: -20px;
    font-size: 10px;
    background-color: rgba(0, 0, 0, 0.7);
    padding: 2px 4px;
    border-radius: 3px;
    white-space: nowrap;
  }
  #stats-panel {
    position: fixed;
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
    background-color: rgba(22, 33, 62, 0.8);
    padding: 10px;
    border-radius: 5px;
    display: none;
  }
  #update-message {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    background-color: #27ae60;
    color: white;
    padding: 10px 20px;
    border-radius: 5px;
    display: none;
    animation: fadeOut 3s forwards;
  }
  @keyframes fadeOut {
    0% { opacity: 1; }
    70% { opacity: 1; }
    100% { opacity: 0; }
  }
  .selected {
    outline: 2px solid #e94560;
  }
</style>
</head>
<body>
<div id="game-container"></div>
<div id="controls-panel">
  <div class="control-group">
    <select id="unit-type">
      <option value="warrior">Warrior</option>
      <option value="archer">Archer</option>
      <option value="mage">Mage</option>
      <option value="healer">Healer</option>
      <option value="tank">Tank</option>
      <option value="musketman">Musketman</option>
    </select>
    <select id="team-select">
      <option value="blue">Blue</option>
      <option value="red">Red</option>
      <option value="purple">Purple</option>
    </select>
  </div>
  <div class="control-group">
    <button onclick="togglePlacementMode()">Placement Mode</button>
    <button onclick="toggleDeleteMode()">Delete Mode</button>
    <button onclick="toggleHealthbarMode()">Healthbar Mode</button>
    <button onclick="toggleSelectionMode()">Selection Mode</button>
  </div>
  <div class="control-group">
    <button onclick="applyFormation('line')">Line</button>
    <button onclick="applyFormation('column')">Column</button>
    <button onclick="applyFormation('wedge')">Wedge</button>
    <button onclick="applyFormation('square')">Square</button>
    <button onclick="applyFormation('circle')">Circle</button>
  </div>
  <div class="control-group">
    <button onclick="startBattle()">Start Battle</button>
    <div id="speed-control">
      <label for="speed-slider">Speed:</label>
      <input type="range" id="speed-slider" min="1" max="20" value="10" onchange="updateSpeed()">
    </div>
  </div>
</div>

<div id="stats-panel"></div>
<div id="update-message">Game layout updated</div>

<script>
  const gameContainer = document.getElementById('game-container');
  const units = { blue: [], red: [], purple: [] };
  let battleSpeed = 10;
  let placementMode = true;
  let deleteMode = false;
  let healthbarMode = false;
  let selectionMode = false;
  let selectedUnits = [];
  let battleInterval;
  
  const unitTypes = {
    warrior: { health: 100, damage: 10, speed: 5, range: 30, isRanged: false, type: 'M', weapon: 'Wooden Sword', attackCooldown: 1000 },
    archer: { health: 90, damage: 15, speed: 6, range: 150, isRanged: true, type: 'R', weapon: 'Bow' },
    mage: { health: 60, damage: 20, speed: 4, range: 160, isRanged: true, type: 'R', weapon: 'Wooden Staff' },
    healer: { health: 70, damage: 5, speed: 5, range: 80, healPower: 10, isRanged: true, type: 'S', weapon: 'Healing Staff' },
    tank: { health: 150, damage: 20, speed: 3, range: 40, isRanged: false, type: 'M', weapon: 'Iron Sword', shield: 'Iron Shield', attackCooldown: 1000 },
    musketman: { health: 80, damage: 25, speed: 4, range: 175, isRanged: true, type: 'R', weapon: 'Musket', attackCooldown: 2000 }
  };
  
  function togglePlacementMode() {
    placementMode = !placementMode;
    if (placementMode) {
      deleteMode = false;
      selectionMode = false;
    }
    updateModeDisplay();
  }

  function toggleDeleteMode() {
  deleteMode = !deleteMode;
  if (deleteMode) {
    placementMode = false;
    selectionMode = false;
  }
  updateModeDisplay();
}

function toggleHealthbarMode() {
  healthbarMode = !healthbarMode;
  gameContainer.classList.toggle('show-health-bars', healthbarMode);
  updateModeDisplay();
}

function toggleSelectionMode() {
  selectionMode = !selectionMode;
  if (selectionMode) {
    placementMode = false;
    deleteMode = false;
  } else {
    clearSelection();
  }
  updateModeDisplay();
}

function updateModeDisplay() {
  gameContainer.style.cursor = placementMode ? 'crosshair' : (deleteMode ? 'not-allowed' : 'default');
}

gameContainer.addEventListener('click', function(e) {
  if (placementMode) {
    const rect = gameContainer.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    addUnit(x, y);
""} else if (deleteMode) {
    const clickedUnit = e.target.closest('.unit');
    if (clickedUnit) {
      deleteUnit(clickedUnit);
    }
  } else if (selectionMode) {
    const clickedUnit = e.target.closest('.unit');
    if (clickedUnit) {
      toggleUnitSelection(clickedUnit);
    } else {
      clearSelection();
    }
  }
});

function toggleUnitSelection(unit) {
  if (unit.classList.contains('selected')) {
    unit.classList.remove('selected');
    selectedUnits = selectedUnits.filter(u => u !== unit);
  } else {
    unit.classList.add('selected');
    selectedUnits.push(unit);
  }
}

function clearSelection() {
  selectedUnits.forEach(unit => unit.classList.remove('selected'));
  selectedUnits = [];
}

function addUnit(x, y) {
  const typeSelect = document.getElementById('unit-type');
  const teamSelect = document.getElementById('team-select');
  const type = typeSelect.value;
  const team = teamSelect.value;
  const unit = document.createElement('div');
  unit.className =  `unit ${type} ${team}`;
  unit.innerHTML = `
    <div class="team-indicator"></div>
    <div class="weapon-icon"></div>
    <div class="health-bar"></div>
    <div class="unit-label">${type.charAt(0).toUpperCase() + type.slice(1)} || ${unitTypes[type].type}</div>
    ${type === 'warrior' ? '<div class="wooden-sword"></div>' : ''}
    ${type === 'mage' ? '<div class="wooden-staff"></div>' : ''}
    ${type === 'archer' ? '<div class="bow"></div>' : ''}
    ${type === 'healer' ? '<div class="healing-staff"></div>' : ''}
    ${type === 'tank' ? '<div class="iron-shield"></div><div class="iron-sword"></div>' : ''}
    ${type === 'musketman' ? '<div class="musket"></div>' : ''}
  `;
  unit.style.left = `${x - 20}px`;
  unit.style.top = `${y - 20}px`;
  Object.assign(unit, unitTypes[type]);
  unit.team = team;
  unit.maxHealth = unit.health;
  unit.projectiles = type === 'healer' ? 3 : 2;
  unit.lastHealTime = 0;
  unit.lastAttackTime = 0;
  unit.lastDirection = { x: 0, y: 0 };
  gameContainer.appendChild(unit);
  units[team].push(unit);
  updateHealthBar(unit);
  if (['warrior', 'mage', 'archer', 'healer', 'tank', 'musketman'].includes(type)) {
    updateWeaponPosition(unit);
  }
}
</script>
</body></html>